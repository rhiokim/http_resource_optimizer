var Todo=function(g,f){var d,e=new TodoBO(g);new TodoAjax;var c=new TodoView(f);c.attach({clickmore:function(a){nhn.Calendar.LayoutManager.showUIO("ToDoList",{complete:a.complete?"ALL":"N"})},changesort:function(a){var b={dblocId:nhn.Calendar.getCommonConfig("userNo"),lpp:99999,sortFieldList:a.sortFieldList,sortTypeList:a.sortTypeList,complete:a.complete?"All":"N"};if(a.groupId)b.groupId=a.groupId;nhn.Calendar.AjaxManager.request("GetTodoListByPage",b,d.updateHandler.bind(d))},containendtodo:function(a){var b=
{dblocId:nhn.Calendar.getCommonConfig("userNo"),count:40,complete:a.complete?"All":"N",todoView:a.complete};if(a.groupId)b.groupId=a.groupId;nhn.Calendar.AjaxManager.request("GetTodoListWithSetView",b,d.updateHandler.bind(d))},changegroup:function(a){a={dblocId:nhn.Calendar.getCommonConfig("userNo"),count:40,groupId:a.groupId,complete:a.complete?"All":"N",todoView:a.complete};nhn.Calendar.AjaxManager.request("GetTodoListWithSetView",a,d.updateHandler.bind(d))},createtodo:function(a){a={dblocId:nhn.Calendar.getCommonConfig("userNo"),
content:a.content,groupId:a.groupId};nhn.Calendar.AjaxManager.request("CreateTodo",a,d.appendHandler.bind(d))},modifytodo:function(a){nhn.Calendar.ModifyToDo.show(a.todoId);clickcr(a.element,"rgt.info","","",a._event,1)},completetodo:function(a){var b=!e.getById(a.todoId).complete,b={dblocId:nhn.Calendar.getCommonConfig("userNo"),todoId:a.todoId,complete:b};nhn.Calendar.AjaxManager.request("SetComplete",b,d.completeHandler.bind(d));clickcr(a.element,"rgt.check","","",a._event,1)},changeimportant:function(a){var b=
e.getById(a.todoId).importance>0?!1:!0,a={dblocId:nhn.Calendar.getCommonConfig("userNo"),todoId:a.todoId,important:b};nhn.Calendar.AjaxManager.request("SetImportance",a,d.importantHandler.bind(d))},droppedschedule:function(a){var b=e.getById(a.todoId);nhn.Calendar.getInstance("MainCalendarSchedule").attachToDo2Schedule(a.event,b,d.moveTodo2Schedule.bind(d))},droppedtodo:function(a){a=a.todo;e.append(a);c.appendTodo(a);c.setGroup();nhn.Calendar.ToDoList.setGroupData(0,"totalTodoCount",1)}});return d=
new ($Class({$init:function(){var a=e.getAll();c.set(a);c.setGroup()},updateHandler:function(a){if(a.result)a.result=="success"?(a=a.returnValue,e.set(a),c.set(a),c.setGroup()):nhn.Calendar.showError(a.errorCode,a.errorMessage)},appendHandler:function(a){if(a.result)if(a.result=="success"){var b=a.returnValue;c.resetInsert();/^(?:0|all)$/.test(c.getSelectedGorup())?(e.append(b),c.appendTodo(b),nhn.Calendar.LayoutManager.getPageId()=="ToDoList"&&nhn.Calendar.ToDoList.refresh(),nhn.Calendar.ToDoList.setGroupData(0,
"totalTodoCount",1)):(b=c.getCompleted(),b={dblocId:nhn.Calendar.getCommonConfig("userNo"),count:40,groupId:c.getSelectedGorup(),complete:b?"All":"N",todoView:b},nhn.Calendar.AjaxManager.request("GetTodoListWithSetView",b,d.updateHandler.bind(d)),nhn.Calendar.ToDoList.setGroupData(a.returnValue.groupId,"totalTodoCount",1));c.setGroup()}else nhn.Calendar.showError(a.errorCode,a.errorMessage)},deleteHandler:function(){},completeHandler:function(a){a.result&&(a.result=="success"?(e.update(a.returnValue),
c.set(e.getAll()),nhn.Calendar.LayoutManager.getPageId()=="ToDoList"&&nhn.Calendar.ToDoList.refresh(),nhn.Calendar.ToDoList.setGroupData(c.getSelectedGorup(),"completeTodoCount",f?1:-1)):nhn.Calendar.showError(a.errorCode,a.errorMessage))},importantHandler:function(a){a.result&&(a.result=="success"?(e.update(a.returnValue),c.set(e.getAll()),nhn.Calendar.LayoutManager.getPageId()=="ToDoList"&&nhn.Calendar.ToDoList.refresh(),nhn.Calendar.ToDoList.setGroupData(c.getSelectedGorup(),"completeTodoCount",
f?1:-1)):nhn.Calendar.showError(a.errorCode,a.errorMessage))},ResizeList:function(a){c.resize(a)},setTodoGroupSelectbox:function(a,b,d,e,h){c.updateGroup(a,b,d,e,h)},refresh:function(){var a=c.getCompleted(),b=c.getSelectedGorup(),a={dblocId:nhn.Calendar.getCommonConfig("userNo"),count:40,complete:a?"All":"N",todoView:a};if(b)a.groupId=b;nhn.Calendar.AjaxManager.request("GetTodoListWithSetView",a,d.updateHandler.bind(d))},moveTodo2Schedule:function(a,b){if(!a)return!1;this.refresh();nhn.Calendar.ToDoList.setGroupData(c.getSelectedGorup(),
"totalTodoCount",-1);c.setGroup();b!=null&&nhn.Calendar.setLocalData("oTodayTodoCount",b)},setFocus:function(){c.focusInsert()},showTodoGroupSelectbox:function(){c.setGroup()},getFormattedValue:function(a,b,c,d){var e={name:5,count:99};a=="name"?c!==!1&&(b=d==null?nhn.Utility.cutStringByPixel(b,80,".."):nhn.Utility.cutStringByPixelIncludeTail(b,85,"..",d)):a=="count"&&b>e[a]&&(b=e[a]+"+");return b},selectedListDelete:function(){var a=c.getCompleted(),b=c.getSelectedGorup(),a={dblocId:nhn.Calendar.getCommonConfig("userNo"),
count:40,complete:a?"All":"N",todoView:a};if(b)a.groupId=b;nhn.Calendar.AjaxManager.request("GetTodoList",a,this.updateHandler.bind(this))}}).extend(jindo.Component))};
